<!DOCTYPE html><!--  This site was created in Webflow. https://webflow.com  --><!--  Last Published: Wed Sep 03 2025 09:32:14 GMT+0000 (Coordinated Universal Time)  -->
<html data-wf-page="685563c009617b1c67e7a7b2" data-wf-site="685413654baa638cbdfc35f7" lang="en">

<head>
  <meta charset="utf-8">
  <title>Verge3D Boat UI</title>
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <meta content="Webflow" name="generator">
  <link href="css/normalize.css" rel="stylesheet" type="text/css">
  <link href="css/webflow.css" rel="stylesheet" type="text/css">
  <link href="css/verge3d-boat-ui.webflow.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
  <script type="text/javascript">WebFont.load({ google: { families: ["Montserrat:100,100italic,200,200italic,300,300italic,400,400italic,500,500italic,600,600italic,700,700italic,800,800italic,900,900italic"] } });</script>
  <script type="text/javascript">!function (o, c) { var n = c.documentElement, t = " w-mod-"; n.className += t + "js", ("ontouchstart" in o || o.DocumentTouch && c instanceof DocumentTouch) && (n.className += t + "touch") }(window, document);</script>
  <link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon">
  <link href="images/webclip.png" rel="apple-touch-icon">
  <style>
    .w-webflow-badge {
      display: none !important;
    }

    /*=============================================
  =                  Nav block                  =
  =============================================*/
    .nav_btn.is-active {
      font-weight: 700;
      color: var(--_colors---text--main);
    }

    .nav_btn.is-active .nav_btn_line {
      transform: translate(0%);
    }

    .nav_component.is-hidden,
    .options_main.is-hidden,
    .options_progress.is-hidden {
      opacity: 0;
      pointer-events: none;
      transform: translateY(-0.5rem);
    }

    .options_main.is-hidden .options_item {
      pointer-events: none;
    }

    /*=====        End of Nav block        ======*/
    /*=============================================
  =                    Toggle                   =
  =============================================*/
    .toggle_component:hover .toggle_switch_bg {
      opacity: 0.25;
    }

    .toggle_component.is-active:hover .toggle_switch_bg {
      opacity: 0.6;
    }

    .toggle_component.is-active .toggle_switch_bg {
      background-color: var(--_colors---brand--main);
    }

    .toggle_component.is-active .toggle_switch_icon {
      transform: translate(-1.5rem, -50%);
    }

    /*=====          End of Toggle         ======*/
    /*=============================================
  =                Water Surface                =
  =============================================*/
    .actions_btn.is-active {
      background-color: var(--_colors---brand--main);
    }

    .actions_btn.is-active:hover {
      background-color: var(--_colors---brand--main-60)
    }

    /*=====      End of Water Surface      ======*/
    /*=============================================
  =                Technical Data               =
  =============================================*/
    .technical-data_text>*:nth-child(2n) {
      font-weight: 600;
    }

    @media screen and (max-width: 479px) {
      .technical-data_text p:nth-child(2n + 1) {
        padding-left: 0;
        padding-right: 0.375rem;
      }

      .technical-data_text p:nth-child(2n) {
        padding-left: 0.375rem;
        padding-right: 0;
      }
    }

    /*=====      End of Technical Data     ======*/
    /*=============================================
  =                   Options                   =
  =============================================*/
    .options_nav-btn.is-hidden {
      opacity: 0;
      pointer-events: none;
    }

    .options_color-btn.is-active {
      border-color: var(--_colors---brand--main);
    }

    .options_color-btn.is-disabled .options_color-btn_colors {
      opacity: 0.5;
    }

    .options_color-btn.is-disabled .options_color-btn_text {
      color: var(--_colors---options--disabled-text);
    }

    .options_btn.is-active,
    .options_btn.is-active+.options_btn {
      background-color: var(--_colors---brand--main);
    }

    @media screen and (pointer: fine) {
      .options_btn:hover+.options_btn {
        background-color: var(--_colors---options--hover);
      }

      .options_btn:active+.options_btn {
        background-color: var(--_colors---options--default);
      }

      .options_btn.is-active:hover,
      .options_btn.is-active:hover+.options_btn,
      .options_btn.is-active+.options_btn:hover {
        background-color: var(--_colors---brand--main-60);
      }

      .options_btn.is-active:active,
      .options_btn.is-active+.options_btn:active {
        background-color: var(--_colors---brand--main-60);
      }
    }

    .options_btn.is-inactive+.options_btn,
    .options_btn.is-disabled+.options_btn {
      pointer-events: none;
      background-image: url(https://cdn.prod.website-files.com/685413654baa638cbdfc35f7/68ad68bd6ee4b6a824f6809f_i-disabled.svg);
      cursor: default;
    }

    /*=====         End of Options         ======*/
    /*=============================================
  =                     Form                    =
  =============================================*/
    .form_error-message.is-shown {
      display: block;
      opacity: 1;
      max-height: 2.375rem;
    }

    /*=====           End of Form          ======*/
    /*=============================================
  =               Tablets > 991px               =
  =============================================*/
    @media screen and (max-width: 1140px) {
      .actions_component {
        flex-flow: column;
        justify-content: flex-end;
        align-items: flex-start;
      }

      .actions_btn {
        margin-top: .75rem;
        margin-right: 0;
      }

      .options_nav-btn:hover {
        background-color: transparent;
      }

      .options_nav-btn:active {
        background-color: var(--_colors---options--hover);
      }
    }

    /*=====     End of Tablets > 991px     ======*/
  </style>
</head>

<body>
  <div id="page-wrapper" class="page-wrapper"><iframe src="G680_test.html" class="model_component"></iframe>
    <header class="header_component">
      <div class="header_content"><button type="button" id="defaul_view_mobile" class="header_btn"><span class="hide">Default view</span><img src="images/canera.svg" alt="" class="header_btn_icon"></button>
        <a href="#" class="brand_component w-inline-block"><img src="images/logo.svg" loading="eager" width="154" height="20" alt="Grand" class="brand_link"></a><button type="button" data-header-nav-open="" class="header_btn"><span class="hide">Open/Close menu</span><img src="images/menu.svg" alt="" class="header_btn_icon"></button>
        <nav id="header-nav" class="header_nav"><button data-popup-open="technical-data" type="button" class="header_nav_link is-tablet">Technical data</button><button type="button" data-copy-url="" class="header_nav_link is-tablet"><span>Copy configuration link</span><span data-success="" class="header_nav_link_success">✓ Address copied!</span></button><button type="button" id="screenshot_mobile" class="header_nav_link is-tablet">Download the configuration image</button><button data-header-nav-close="" type="button" class="header_nav_link is-tablet">BACK</button>
          <div data-header-nav-close="" class="header_nav_overlay"></div>
        </nav>
      </div>
    </header>
    <div id="nav-component" class="nav_component"><button type="button" data-nav-btn="" class="nav_btn"><span class="nav_btn_caption-visible">Summary</span><span class="nav_btn_caption-base">Summary</span><span class="nav_btn_line"></span></button></div>
    <div id="features-toggle" class="features-toggle is-hidden"><button type="button" id="toggle_features" data-3d-action="" data-toggle-active-class="" class="toggle_component"><span class="toggle_caption">Show features</span><span class="toggle_switch"><span class="toggle_switch_bg"></span><span class="toggle_switch_icon"></span></span></button></div>
    <div id="actions-component" class="actions_component is-hidden"><button type="button" id="screenshot_desktop" class="actions_btn"><span>Screenshot</span><img src="images/screenshot.svg" loading="lazy" alt="" class="actions_btn_icon"></button><button type="button" id="defaul_view_desktop" class="actions_btn"><span>Default view</span><img src="images/canera.svg" loading="lazy" alt="" class="actions_btn_icon"></button><button type="button" id="" data-popup-open="technical-data" class="actions_btn"><span>Technical data</span><img src="images/star-list.svg" loading="lazy" alt="" class="actions_btn_icon"></button><button type="button" id="water_surface_desktop" data-3d-action="" data-toggle-active-class="" class="actions_btn"><span>Water surface</span><img src="images/waves.svg" loading="lazy" alt="" class="actions_btn_icon"></button></div>
    <div id="options-component" class="options_component is-hidden">
      <div id="options-main" class="options_main">
        <div id="options-items" class="options_items">
          <div data-options-item="" class="options_item">
            <h2 class="options_title is-main">Summary</h2>
            <div class="options_controls">
              <div class="options_controls_group"><button type="button" id="screenshot_summary" class="options_btn is-summary">Download the configuration image</button></div>
              <div class="options_controls_group"><button type="button" data-copy-url="" class="options_btn is-summary"><span>Copy the configuration link</span><span data-success="" class="options_btn_success">✓ Address copied!</span></button></div>
              <div class="options_controls_group"><button type="button" data-popup-open="form" id="form-open-modal-btn" class="options_btn is-summary">Send to dealler</button></div>
            </div>
          </div>
        </div><button type="button" id="options-prev-btn" class="options_nav-btn is-prev is-hidden"><span class="hide">Next Option</span></button><button type="button" id="options-next-btn" class="options_nav-btn is-next"><span class="hide">Next Option</span></button>
      </div>
      <div class="options_footer">
        <div id="options-progress" class="options_progress"><span id="options-indicator">1</span><span>/</span><span id="options-count"> </span></div><button type="button" id="toggle-hide-menu" class="toggle_component"><span class="toggle_caption">Hide menu</span><span class="toggle_switch"><span class="toggle_switch_bg"></span><span class="toggle_switch_icon"></span></span></button>
      </div>
    </div>
    <div data-popup="form" class="popup_component">
      <div data-popup-overlay="form" class="popup_overlay"></div>
      <div data-popup-content="form" class="popup_content"><button type="button" data-popup-close="form" class="popup_close">
          <div class="popup_close_line"></div>
          <div class="popup_close_line is-2"></div>
        </button>
        <div class="popup_slot">
          <form id="summary-form" class="form_component"><input type="hidden" name="screen" required="" value=""><input type="hidden" name="link" value="">
            <div class="form_item"><label for="form-name" class="form_label">Name</label><input id="form-name" type="text" name="name" required="" class="form_input"></div>
            <div class="form_item"><label for="form-country" class="form_label">Country</label><select id="form-country" name="country" required="" class="form_input is-select"></select></div>
            <div class="form_item"><label for="form-e-mail" class="form_label">E-Mail</label><input id="form-e-mail" type="email" name="email" required="" class="form_input"></div>
            <div class="form_item"><label for="form-phone" class="form_label">Phone</label><input id="form-phone" type="tel" name="phone" required="" class="form_input"></div>
            <div class="form_item"><label for="form-city" class="form_label">City</label><input id="form-city" type="text" name="city" class="form_input"></div>
            <div class="form_item"><label for="form-comment" class="form_label">Comment</label><textarea id="form-comment" name="comment" rows="5" class="form_input is-textarea"></textarea></div>
            <div id="summary-form-error" class="form_error-message w-node-_27fc4c1e-bd45-1706-8eee-7d346a0357cc-e6a1b6e7">
              <div>Something went wrong while submitting the form. Please try again.</div>
            </div><button type="submit" id="summary-form-submit" class="form_submit">Submit</button><button type="button" data-popup-open="form-success" class="hide">Open success popup</button>
          </form>
        </div>
      </div>
    </div>
    <div data-popup="form-success" class="popup_component">
      <div data-popup-overlay="form-success" class="popup_overlay"></div>
      <div data-popup-content="form-success" class="popup_content"><button type="button" data-popup-close="form-success" class="popup_close">
          <div class="popup_close_line"></div>
          <div class="popup_close_line is-2"></div>
        </button>
        <div class="popup_slot">
          <div class="success-message_component">
            <div>Your request has been submitted</div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=685413654baa638cbdfc35f7" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="js/webflow.js" type="text/javascript"></script>
  <script defer="" src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/gsap.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/gsap.min.js"></script>


  <script>

    document.addEventListener('DOMContentLoaded', () => {

      /*=============================================
      =                GSAP Defaults                =
      =============================================*/

      const defaultDuration = 0.2;
      const defaultEase = 'power2.out';

      gsap.defaults({
        duration: defaultDuration,
        ease: defaultEase
      });


      /*=====      End of GSAP Defaults      ======*/




      /*=============================================
      =          Global Elements/Functions          =
      =============================================*/

      const apiUrl = ' https://grand3d-backend-production.up.railway.app/api';

      const urlParams = new URLSearchParams(window.location.search);
      const boatId = urlParams.get('id');

      const popupDuration = 0.3;

      const pageWrapper = document.querySelector('#page-wrapper');
      const navComponent = pageWrapper.querySelector('#nav-component');
      const headerNav = pageWrapper.querySelector('#header-nav');

      const prevOptionBtn = pageWrapper.querySelector('#options-prev-btn');
      const nextOptionBtn = pageWrapper.querySelector('#options-next-btn');
      const optionIndicator = pageWrapper.querySelector('#options-indicator');
      const optionCount = pageWrapper.querySelector('#options-count');
      const optionItems = pageWrapper.querySelector('#options-items');

      const summaryForm = pageWrapper.querySelector('#summary-form');

      const isDesktop = window.matchMedia('(min-width: 992px)').matches;

      function globalFuncs() {
        init3dActionIds();
        handleNavBtnClicks();
        handleOptions();
        handlePopups();
        colorFilter();
        optionFilter();
      }

      function addHiddenInput(form, name, value = '') {
        if (!form || !name) return;

        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = name;
        input.value = value;

        form.prepend(input);
      }

      /*===  End of Global Elements/Functions  ====*/




      /*=============================================
      =                Get Boat Data                =
      =============================================*/
      async function fetchData() {
        const cacheKey = 'dataCache';

        const cached = sessionStorage.getItem(cacheKey);
        if (cached) {
          try {
            const data = JSON.parse(cached);
            return data;
          } catch {
            // If cache is corrupted, remove it
            sessionStorage.removeItem(cacheKey);
          }
        }

        const response = await fetch(`${apiUrl}/cms/boats/${boatId}`, {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json',
          }
        });

        if (!response.ok) {
          throw new Error('Boat Fetch error: status ' + response.status);
        }

        const data = await response.json();

        sessionStorage.setItem(cacheKey, JSON.stringify(data));
        return data;
      }

      async function fetchDataSequentially() {
        let data = null;

        try {
          data = await fetchData();
        } catch (error) {
          console.error('Boat Fetch error:', error);
        }

        if (!data) {
          console.warn('No boat data to process');
          return;
        }

        const boatData = data;


        /*----------  Add Nav Links  ----------*/

        const navLinks = [
          ['all-models-text', 'all-models-link'],
          ['dealers-text', 'dealers-link'],
          ['model-details-text', 'model-details-link'],
        ];

        const fragment = document.createDocumentFragment();

        navLinks.forEach(([textKey, linkKey]) => {
          const text = boatData[textKey];
          const link = boatData[linkKey];
          if (text && link) {
            const a = document.createElement('a');
            a.href = link;
            a.className = 'header_nav_link';
            a.textContent = text;
            a.target = '_blank';
            fragment.appendChild(a);
          }
        });

        headerNav.insertBefore(fragment, headerNav.firstChild);


        /*----------  Add Technical Data  ----------*/

        const technicalData = boatData['technical-data-2'];

        if (technicalData && pageWrapper) {
          const popup = document.createElement('div');
          popup.dataset.popup = 'technical-data';
          popup.className = 'popup_component';
          popup.innerHTML = `
          <div data-popup-overlay="technical-data" class="popup_overlay"></div>
          <div data-popup-content="technical-data" class="popup_content">
            <button type="button" data-popup-close="technical-data" class="popup_close">
              <div class="popup_close_line"></div>
              <div class="popup_close_line is-2"></div>
            </button>
            <div class="popup_slot">
              <div class="technical-data_component">
                <h2 class="technical-data_title">Technical data</h2>
                <div class="technical-data_text w-richtext">
                  ${technicalData}
                </div>
              </div>
            </div>
          </div>
        `;

          pageWrapper.appendChild(popup);
        }



        /*----------  Add Color  ----------*/

        const optionItemsData = [
          ['color-option-title', 'color-option-1-subtitle-1', 'color-option-1-colors-1', 'color-option-1-subtitle-2', 'color-option-1-colors-2'],
          ['color-option-2-title', 'color-option-2-subtitle-1', 'color-option-2-colors-1', 'color-option-2-subtitle-2', 'color-option-2-colors-2'],
          ['color-option-3-title', 'color-option-3-subtitle-1', 'color-option-3-colors-1', 'color-option-3-subtitle-2', 'color-option-3-colors-2'],
          ['color-option-4-title', 'color-option-4-subtitle-1', 'color-option-4-colors-1', 'color-option-4-subtitle-2', 'color-option-4-colors-2']
        ];

        const colorOptionsFragment = document.createDocumentFragment();
        const colorNavFragment = document.createDocumentFragment();

        function renderColorControls(colorsArray, groupName, groupIndex, subgroupIndex) {
          const valueFieldName = `tab-${groupIndex}-color-${subgroupIndex}`;
          addHiddenInput(summaryForm, valueFieldName);

          const controls = document.createElement('div');
          controls.className = 'options_controls is-grid';
          controls.dataset.optionControls = '';

          colorsArray.forEach(color => {
            const button = document.createElement('button');
            button.type = 'button';
            button.className = 'options_color-btn';
            button.dataset.optionBtn = '';
            button.dataset['3dAction'] = '';
            button.dataset.fieldName = valueFieldName;
            button.dataset.value = `${groupName}: ${color['color-name']}`;
            button.id = `${color['color-id']}`;

            const filterColors = color['filter-colors'];
            if (Array.isArray(filterColors) && filterColors.length > 0) {
              filterColors.forEach(color => {
                const ids = filterColors.map(c => c['color-id']).filter(Boolean);
                button.dataset.filterColors = ids.join(', ');
              })
            }

            const colorWrap = document.createElement('span');
            colorWrap.className = 'options_color-btn_colors';

            if (color['color-image'] && color['color-image'].url) {
              const img = document.createElement('img');
              img.src = color['color-image'].url;
              img.loading = 'lazy';
              img.alt = `${color['color-name'] || 'Color'} image`;
              img.className = 'options_color-btn_image';
              colorWrap.appendChild(img);
            } else {
              if (color['color-1']) {
                const color1 = document.createElement('span');
                if (color['colors-divider']) {
                  color1.className = 'options_color-btn_color-1 with-divider';
                } else {
                  color1.className = 'options_color-btn_color-1';
                }
                color1.style.backgroundColor = color['color-1'];
                colorWrap.appendChild(color1);

              }

              if (color['color-2']) {
                const color2 = document.createElement('span');
                if (color['colors-divider']) {
                  color2.className = 'options_color-btn_color-2 with-divider';
                } else {
                  color2.className = 'options_color-btn_color-2';
                }
                color2.style.backgroundColor = color['color-2'];
                colorWrap.appendChild(color2);
              }

              if (color['text-on-color']) {
                const colorText = document.createElement('span');
                colorText.className = 'options_color-btn_color-text';
                colorText.textContent = color['text-on-color'];

                if (color['text-color']) {
                  colorText.style.color = color['text-color'];
                }

                colorWrap.appendChild(colorText);
              }
            }

            const name = document.createElement('span');
            name.className = 'options_color-btn_text';
            name.textContent = color['color-name'] || color['color-id'] || '';

            button.appendChild(colorWrap);
            button.appendChild(name);
            controls.appendChild(button);
          });

          const total = colorsArray.length;
          const remainder = total % 6;
          if (remainder !== 0) {
            const fillersNeeded = 6 - remainder;
            for (let i = 0; i < fillersNeeded; i++) {
              const filler = document.createElement('div');
              filler.className = 'options_color-btn is-empty';
              controls.appendChild(filler);
            }
          }

          return controls;
        }


        optionItemsData.forEach(([titleKey, subTitleOneKey, colorsOneKey, subTitleTwoKey, colorsTwoKey], index) => {
          const title = boatData[titleKey];
          const subTitleOne = boatData[subTitleOneKey];
          const groupNameOne = subTitleOne !== undefined ? title + ' | ' + subTitleOne : title;
          const colorsOne = boatData[colorsOneKey];
          const subTitleTwo = boatData[subTitleTwoKey];
          const colorsTwo = boatData[colorsTwoKey];
          const groupNameTwo = subTitleTwo !== undefined ? title + ' | ' + subTitleTwo : '';

          if (title || subTitleOne || Array.isArray(colorsOne) || subTitleTwo || Array.isArray(colorsTwo)) {
            const item = document.createElement('div');
            item.dataset.optionsItem = '';
            item.className = 'options_item';

            if (index === 0) {
              item.classList.add('is-active');
            }

            if (title) {
              const h2 = document.createElement('h2');
              h2.className = 'options_title is-main';
              h2.innerHTML = title;
              item.appendChild(h2);

              const button = document.createElement('button');
              button.type = 'button';
              button.dataset.navBtn = '';
              button.className = 'nav_btn';

              if (index === 0) {
                button.classList.add('is-active');
              }

              button.innerHTML = `
              <span class="nav_btn_caption-visible">${title}</span>
              <span class="nav_btn_caption-base">${title}</span>
              <span class="nav_btn_line"></span>
            `;

              colorNavFragment.appendChild(button);
            }

            if (subTitleOne) {
              const h3 = document.createElement('h3');
              h3.className = 'options_title';
              h3.textContent = subTitleOne;
              item.appendChild(h3);
            }

            if (Array.isArray(colorsOne) && colorsOne.length > 0) {
              const controls = renderColorControls(colorsOne, groupNameOne, index + 1, 1);
              item.appendChild(controls);
            }

            if (subTitleTwo) {
              const h3 = document.createElement('h3');
              h3.className = 'options_title';
              h3.textContent = subTitleTwo;
              item.appendChild(h3);
            }

            if (Array.isArray(colorsTwo) && colorsTwo.length > 0) {
              const controls = renderColorControls(colorsTwo, groupNameTwo, index + 1, 2);
              item.appendChild(controls);
            }

            colorOptionsFragment.appendChild(item);
          }

        });

        navComponent.insertBefore(colorNavFragment, navComponent.firstChild);
        optionItems.insertBefore(colorOptionsFragment, optionItems.firstChild);



        /*----------  Add Options  ----------*/
        const options = boatData.options || [];

        const optionsFragment = document.createDocumentFragment();
        const optionsNavFragment = document.createDocumentFragment();

        const countTab1 = boatData['options-count-tab-1'] || 9;
        const countTab2 = boatData['options-count-tab-2'] || 9;
        const defaultGroupSize = 9;

        let currentControls;
        let groupCount = 0;
        let item;
        let processedCount = 0;

        options.forEach((option, index) => {
          const {
            title,
            'button-id': buttonId,
            'option-code': optionCode,
            'image-2d': image2d,
            'has-3d': has3d,
            'filter-colors': filterColors,
            'mutual-exclusion-option': mutualOption,
            'activator-option': activatorOption
          } = option;

          const codeFieldName = `option-${index + 1}`;
          addHiddenInput(summaryForm, codeFieldName);

          let groupSize;
          if (groupCount === 0) {
            groupSize = countTab1;
          } else if (groupCount === 1) {
            groupSize = countTab2;
          } else {
            groupSize = defaultGroupSize;
          }

          if (processedCount === 0) {
            item = document.createElement('div');
            item.dataset.optionsItem = '';
            item.classList.add('options_item');

            const h2 = document.createElement('h2');
            h2.classList.add('options_title', 'is-main');
            h2.textContent = `Equipment - ${groupCount + 1}`;
            item.appendChild(h2);

            currentControls = document.createElement('div');
            currentControls.classList.add('options_controls');
            currentControls.dataset.optionControls = '';
            currentControls.dataset.multiple = '';
            item.appendChild(currentControls);

            optionsFragment.appendChild(item);

            const button = document.createElement('button');
            button.type = 'button';
            button.dataset.navBtn = '';
            button.className = 'nav_btn';
            button.innerHTML = `
            <span class="nav_btn_caption-visible">Equipment - ${groupCount + 1}</span>
            <span class="nav_btn_caption-base">Equipment - ${groupCount + 1}</span>
            <span class="nav_btn_line"></span>
          `;
            optionsNavFragment.appendChild(button);

            groupCount++;
          }

          const mainBtn = document.createElement('button');
          mainBtn.type = 'button';
          mainBtn.id = buttonId;
          mainBtn.classList.add('options_btn');
          mainBtn.dataset.optionBtn = '';
          mainBtn.dataset['3dAction'] = '';
          mainBtn.dataset.code = optionCode;
          mainBtn.dataset.value = `${title} (${optionCode})`;
          mainBtn.dataset.codeFieldName = codeFieldName;
          mainBtn.textContent = title;

          if (Array.isArray(filterColors) && filterColors.length > 0) {
            filterColors.forEach(color => {
              const ids = filterColors.map(c => c['color-id']).filter(Boolean);
              mainBtn.dataset.setColor = ids.join(', ');
            })
          }

          if (Array.isArray(mutualOption) && mutualOption.length > 0) {
            mutualOption.forEach(option => {
              const ids = mutualOption.map(o => o['button-id']).filter(Boolean);
              mainBtn.dataset.mutualOption = ids.join(', ');
            });
          }

          if (Array.isArray(activatorOption) && activatorOption.length > 0) {
            activatorOption.forEach(option => {
              const ids = activatorOption.map(o => o['button-id']).filter(Boolean);
              mainBtn.dataset.activatorOption = ids.join(', ');
            });
            mainBtn.classList.add('is-disabled');
          }

          const has2d = !!image2d;

          const controlsGroup = document.createElement('div');
          controlsGroup.classList.add('options_controls_group');

          controlsGroup.appendChild(mainBtn);

          const extraBtn = document.createElement('button');
          extraBtn.type = 'button';
          extraBtn.classList.add('options_btn', 'is-info');
          extraBtn.textContent = 'i';

          if (has2d) {
            extraBtn.dataset.popupOpen = `parts-${index + 1}`;

            const popup = document.createElement('div');
            popup.dataset.popup = `parts-${index + 1}`;
            popup.className = 'popup_component';

            popup.innerHTML = `
            <div data-popup-overlay="parts-${index + 1}" class="popup_overlay"></div>
            <div data-popup-content="parts-${index + 1}" class="popup_content">
              <button type="button" data-popup-close="parts-${index + 1}" class="popup_close">
                <div class="popup_close_line"></div>
                <div class="popup_close_line is-2"></div>
              </button>
              <div class="popup_slot">
                <img src="${image2d.url}" loading="lazy" alt="${title}" class="popup_image">
              </div>
            </div>
          `;

            pageWrapper.appendChild(popup);
            controlsGroup.appendChild(extraBtn);
          } else if (has3d) {
            extraBtn.id = `d_${buttonId}_info`;
            controlsGroup.appendChild(extraBtn);
          }

          currentControls.appendChild(controlsGroup);

          processedCount++;
          if (processedCount === groupSize) {
            processedCount = 0;
          }
        });

        navComponent.insertBefore(optionsNavFragment, navComponent.lastElementChild);
        optionItems.insertBefore(optionsFragment, optionItems.lastElementChild);



        /*----------  Run Global Functions  ----------*/

        globalFuncs();
      }

      if (!document.body.hasAttribute('data-no-fetch')) {
        fetchDataSequentially();
      }


      /*=====      End of Get Boat Data      ======*/





      /*=============================================
      =            3D Model Loading Check           =
      =============================================*/

      const iframe = document.querySelector('.model_component');

      function waitForAppLoaded(iframeWindow) {
        const timeoutDuration = 3 * 60 * 1000; // 3 min

        return new Promise((resolve, reject) => {
          const interval = setInterval(() => {
            if (iframeWindow.is3DLoaded === true) {
              clearInterval(interval);
              resolve('3D is loaded!');
            } else {
              console.log('Loading Check');
            }
          }, 100);

          setTimeout(() => {
            clearInterval(interval);
            resolve('Timeout waiting for 3D to load');
          }, timeoutDuration);
        });
      }

      iframe.onload = () => {
        const iframeWindow = iframe.contentWindow;
        waitForAppLoaded(iframeWindow).then(msg => {
          applyUrlParams();
          const elements = document.querySelectorAll('#features-toggle, #actions-component, #options-component');

          elements.forEach(element => {
            if (element.classList.contains('is-hidden')) {
              element.classList.remove('is-hidden');
            }
          });
          console.log(msg)
        });
      };

      /*=====  End of 3D Model Loading Check ======*/






      /*=============================================
      =                3D Action Ids                =
      =============================================*/

      function init3dActionIds() {
        document.querySelectorAll('[data-3d-action]').forEach(el => {
          const currentId = el.id;

          if (currentId && !currentId.startsWith('d_') && !currentId.startsWith('e_')) {
            el.id = 'd_' + currentId;
          }

          el.addEventListener('click', () => {
            const id = el.id;

            if (id.startsWith('d_')) {
              el.id = id.replace(/^d_/, 'e_');
            } else if (id.startsWith('e_')) {
              el.id = id.replace(/^e_/, 'd_');
            }

            if (el.dataset.toggleActiveClass !== undefined) {
              el.classList.toggle('is-active');
            }
          });
        });
      }


      /*=====      End of 3D Action Ids      ======*/




      /*=============================================
      =                   Filter                    =
      =============================================*/

      function colorFilter() {
        const colorButtons = [...document.querySelectorAll('[data-option-btn][data-field-name]')];

        const filterButtons = colorButtons.filter(btn => btn.dataset.filterColors);
        filterButtons.forEach(btn => btn.classList.add('is-disabled'));

        const allowedIds = new Set();
        filterButtons.forEach(btn => {
          btn.dataset.filterColors
            .split(',')
            .map(x => x.trim())
            .forEach(id => allowedIds.add(id));
        });

        const filteredButtons = colorButtons.filter(btn => !btn.hasAttribute('data-filter-colors'));

        filteredButtons.forEach(filterBtn => {
          filterBtn.addEventListener('click', () => {
            const clearId = filterBtn.id.replace(/^d_|^e_/, '');

            filterButtons.forEach(targetBtn => {
              const filterValues = targetBtn.dataset.filterColors
                .split(',')
                .map(x => x.trim());

              const shouldDisable = !filterValues.includes(clearId);

              if (shouldDisable) {
                const wasActive = targetBtn.classList.contains('is-active');
                targetBtn.classList.add('is-disabled');

                if (targetBtn.id.startsWith('e_')) {
                  targetBtn.id = targetBtn.id.replace(/^e_/, 'd_');
                }

                if (wasActive) {
                  targetBtn.classList.remove('is-active');

                  const group = targetBtn.closest('[data-option-controls]');
                  if (group) {
                    const siblings = [...group.querySelectorAll('[data-option-btn][data-field-name]')];
                    const available = siblings.find(btn =>
                      !btn.classList.contains('is-disabled') && btn !== targetBtn
                    );
                    if (available) {
                      available.click();
                    }
                  }
                }
              } else {
                targetBtn.classList.remove('is-disabled');
              }
            });
          });
        });
      }


      function optionFilter() {
        const buttons = document.querySelectorAll('[data-option-btn]');

        buttons.forEach(btn => {
          btn.addEventListener('click', () => {
            const currentId = btn.id;
            const currentCleanId = currentId.replace(/^(e_|d_)/, '');

            const activatorButtons = document.querySelectorAll(`[data-activator-option*="${currentCleanId}"]`);

            if (currentId.startsWith('e_')) {
              activatorButtons.forEach(activatorBtn => {
                activatorBtn.classList.remove('is-disabled');
              });
            } else if (currentId.startsWith('d_')) {
              activatorButtons.forEach(activatorBtn => {
                if (activatorBtn.id.includes('e_')) {
                  activatorBtn.click();
                  activatorBtn.classList.add('is-disabled');
                } else {
                  activatorBtn.classList.add('is-disabled');
                }
              });
            }

            if (btn.hasAttribute('data-mutual-option')) {
              const mutualIds = btn.dataset.mutualOption.split(' ');
              const mutualButtons = Array.from(document.querySelectorAll('[data-option-btn]')).filter(b => {
                const cleanId = b.id.slice(2);
                return mutualIds.includes(cleanId);
              });

              if (currentId.startsWith('e_')) {
                mutualButtons.forEach(mutualBtn => {
                  if (mutualBtn.id.startsWith('e_')) {
                    mutualBtn.click();
                    mutualBtn.classList.add('is-inactive');
                  } else {
                    mutualBtn.classList.add('is-inactive');
                  }
                });
              }

              if (currentId.startsWith('d_')) {
                mutualButtons.forEach(mutualBtn => {
                  mutualBtn.classList.remove('is-inactive');
                });
              }
            }

            if (btn.hasAttribute('data-set-color')) {
              const colors = btn.dataset.setColor.split(' ');

              colors.forEach(color => {
                const targets = document.querySelectorAll(
                  `[data-option-btn][data-field-name][id*="${color}"]`
                );

                targets.forEach(targetBtn => {
                  const siblingBtns = targetBtn
                    .closest('[data-option-controls]')
                    ?.querySelectorAll('[data-option-btn]');

                  if (btn.classList.contains('is-active')) {
                    siblingBtns?.forEach(sibling => {
                      sibling.classList.remove('is-disabled');
                    });
                  } else {
                    targetBtn.click();

                    siblingBtns?.forEach(sibling => {
                      if (sibling !== targetBtn) {
                        sibling.classList.add('is-disabled');
                        if (sibling.id.startsWith('e_')) {
                          sibling.id = sibling.id.replace(/^e_/, 'd_');
                        }
                      }
                    });
                  }
                });
              });
            }
          });
        });
      }

      /*=====         End of Filter          ======*/




      /*=============================================
      =                  Nav Block                  =
      =============================================*/

      function handleNavBtnClicks() {
        if (navComponent) {
          const allBtns = [...navComponent.querySelectorAll('[data-nav-btn]')];
          const optionItems = [...document.querySelectorAll('[data-options-item]')];

          navComponent.addEventListener('click', event => {

            const button = event.target.closest('[data-nav-btn]');
            if (!button || !navComponent.contains(button) || button.classList.contains('is-active')) return;

            const activeBtn = navComponent.querySelector('[data-nav-btn].is-active');
            if (activeBtn) {
              const activeIndex = allBtns.indexOf(activeBtn);
              if (activeIndex !== -1 && optionItems[activeIndex]) {
                optionItems[activeIndex].classList.remove('is-active');
              }
              activeBtn.classList.remove('is-active');
            }

            button.classList.add('is-active');

            const clickedIndex = allBtns.indexOf(button);
            if (clickedIndex !== -1 && optionItems[clickedIndex]) {
              optionItems[clickedIndex].classList.add('is-active');
            }

            prevOptionBtn.classList.toggle('is-hidden', clickedIndex === 0);
            nextOptionBtn.classList.toggle('is-hidden', clickedIndex === allBtns.length - 1);

            if (optionIndicator) {
              optionIndicator.textContent = clickedIndex + 1;
            }
          });
        }
      }

      /*=====        End of Nav Block        ======*/




      /*=============================================
      =               Toggle Hide Menu               =
      =============================================*/

      const toggleHideMenu = document.getElementById('toggle-hide-menu');

      if (toggleHideMenu) {
        const optionsMain = document.getElementById('options-main');
        const optionsProgress = document.getElementById('options-progress');

        toggleHideMenu.addEventListener('click', () => {
          toggleHideMenu.classList.toggle('is-active');
          optionsMain.classList.toggle('is-hidden');
          optionsProgress.classList.toggle('is-hidden');
          if (isDesktop) {
            navComponent.classList.toggle('is-hidden');
          }
        });
      }

      /*=====     End of Toggle Hide Menu     ======*/




      /*=============================================
      =               Mobile Menu               =
      =============================================*/

      if (headerNav) {
        const headerNavDuration = 0.3;

        document.querySelectorAll('[data-header-nav-open]').forEach(el => {
          el.addEventListener('click', () => {
            headerNav.style.display = 'flex';
            gsap.to(headerNav, {
              opacity: 1,
              duration: headerNavDuration
            });
          });
        });

        document.querySelectorAll('[data-header-nav-close]').forEach(el => {
          el.addEventListener('click', () => {
            gsap.to(headerNav, {
              opacity: 0,
              duration: headerNavDuration,
              onComplete: () => {
                headerNav.style.display = 'none';
              }
            });
          });
        });
      }

      /*=====     End of Mobile Menu     ======*/




      /*=============================================
      =                    Popups                   =
      =============================================*/

      function handlePopups() {
        document.querySelectorAll('[data-popup-open]').forEach(button => {
          button.addEventListener('click', () => {
            const popupName = button.dataset.popupOpen;
            const popup = document.querySelector(`[data-popup="${popupName}"]`);
            const content = popup.querySelector('[data-popup-content]');
            const overlay = popup.querySelector('[data-popup-overlay]');
            const close = popup.querySelector('[data-popup-close]');

            popup.style.display = 'flex';

            gsap.timeline({
              defaults: {
                duration: popupDuration
              }
            })
              .to(popup, {
                opacity: 1
              })
              .to(overlay, {
                opacity: 0.35
              }, '<')
              .to(content, {
                y: '0rem',
                opacity: 1
              }, '<25%')
              .set('body', {
                overflow: 'hidden'
              }, '<75%')
              .to(close, {
                opacity: 1
              }, '<');

          });
        });

        document.querySelectorAll('[data-popup-close], [data-popup-overlay]').forEach(el => {
          el.addEventListener('click', () => {
            const popupName = el.dataset.popupClose || el.dataset.popupOverlay;
            const popup = document.querySelector(`[data-popup="${popupName}"]`);
            const content = popup.querySelector('[data-popup-content]');
            const overlay = popup.querySelector('[data-popup-overlay]');
            const close = popup.querySelector('[data-popup-close]');

            gsap.timeline({
              defaults: {
                duration: popupDuration
              },
              onComplete: () => {
                popup.style.display = 'none';
              }
            })
              .to(close, {
                opacity: 0
              })
              .to(content, {
                y: '4rem',
                opacity: 0
              }, '<75%')
              .set('body', {
                clearProps: 'all'
              }, '<25%')
              .to(
                [
                  popup,
                  overlay
                ],
                {
                  opacity: 0
                }
                , '<');
          });
        });
      }

      /*=====          End of Popups         ======*/




      /*=============================================
      =                   Options                   =
      =============================================*/
      function handleOptions() {
        const navButtons = [...document.querySelectorAll('[data-nav-btn]')];
        const optionItems = [...document.querySelectorAll('[data-options-item]')];
        const firstOptionItem = optionItems[0];
        const optionsCount = optionItems.length;
        const lastOptionItem = optionItems[optionsCount - 1];

        if (optionCount) {
          optionCount.textContent = optionsCount;
        }

        function updateActiveItem(direction) {
          const current = document.querySelector('[data-options-item].is-active');
          if (!current) return;

          const target = direction === 'next'
            ? current.nextElementSibling
            : current.previousElementSibling;

          const buttonToHide = direction === 'next' ? nextOptionBtn : prevOptionBtn;
          const buttonToShow = direction === 'next' ? prevOptionBtn : nextOptionBtn;

          if (buttonToShow?.getAttribute('data-hidden') === 'true') {
            buttonToShow.dataset.hidden = 'false';
          }

          if (target && target.matches('[data-options-item]')) {
            current.classList.remove('is-active');
            target.classList.add('is-active');
          } else {
            return;
          }

          const newCurrent = document.querySelector('[data-options-item].is-active');

          prevOptionBtn.classList.toggle('is-hidden', newCurrent === firstOptionItem);
          nextOptionBtn.classList.toggle('is-hidden', newCurrent === lastOptionItem);

          const newIndex = optionItems.indexOf(newCurrent);
          if (newIndex === -1) return;

          const currentActiveNav = document.querySelector('[data-nav-btn].is-active');
          if (currentActiveNav) {
            currentActiveNav.classList.remove('is-active');
          }

          if (navButtons[newIndex]) {
            navButtons[newIndex].click();
          }

          if (optionIndicator) {
            optionIndicator.textContent = newIndex + 1;
          }
        }

        prevOptionBtn?.addEventListener('click', () => updateActiveItem('prev'));
        nextOptionBtn?.addEventListener('click', () => updateActiveItem('next'));


        const colorControls = document.querySelectorAll('[data-option-controls]');

        colorControls.forEach(controlGroup => {
          const isMultiple = controlGroup.hasAttribute('data-multiple');

          controlGroup.addEventListener('click', event => {
            const clickedButton = event.target.closest('[data-option-btn]');
            if (!clickedButton) return;

            const url = new URL(window.location);
            const params = url.searchParams;

            if (isMultiple) {
              const isNowActive = clickedButton.classList.toggle('is-active');
              const urlOption = clickedButton.dataset.code;
              let values = params.get('options')
                ?.split('-')
                .filter(Boolean) || [];
              const index = values.indexOf(urlOption);

              if (isNowActive) {
                if (index === -1) {
                  values.push(urlOption);
                }

                summaryForm.querySelector(`[name="${clickedButton.dataset.codeFieldName}"]`).value = clickedButton.dataset.value;
              } else {
                if (index > -1) {
                  values.splice(index, 1);
                }

                summaryForm.querySelector(`[name="${clickedButton.dataset.codeFieldName}"]`).value = '';
              }

              if (values.length) {
                params.set('options', values.join('-'));
              } else {
                params.delete('options');
              }

              const baseUrl = window.location.origin + window.location.pathname;
              const newUrl = `${baseUrl}?${params.toString()}`;

              window.history.replaceState({}, '', newUrl);

            } else {
              const currentActiveButton = controlGroup.querySelector('[data-option-btn].is-active');
              if (currentActiveButton) {
                const currentId = currentActiveButton.id;
                if (currentId.startsWith('e_')) {
                  currentActiveButton.id = currentId.replace(/^e_/, 'd_');
                }
                currentActiveButton.classList.remove('is-active');
              }

              clickedButton.classList.add('is-active');

              const fieldName = clickedButton.dataset.fieldName;
              const fieldValue = clickedButton.dataset.value;

              summaryForm.querySelector(`[name="${fieldName}"]`).value = fieldValue;
              params.set(fieldName, fieldValue);

              const baseUrl = window.location.origin + window.location.pathname;
              const newUrl = `${baseUrl}?${params.toString()}`;

              window.history.replaceState({}, '', newUrl);

            }
          });
        });
      }

      /*=====         End of Options         ======*/





      /*=============================================
      =               Countries Select              =
      =============================================*/

      fetch('https://s3.us-east-1.amazonaws.com/assets.vvmd.team/Grand3d/countries.gz.json')
        .then(response => {
          if (!response.ok) throw new Error('Network response was not ok');
          return response.json();
        })
        .then(countries => {
          const select = document.getElementById('form-country');
          if (select) {
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = 'Select a country';
            defaultOption.disabled = true;
            defaultOption.selected = true;
            select.appendChild(defaultOption);

            countries.forEach(country => {
              const option = document.createElement('option');
              option.value = country;
              option.textContent = country;
              select.appendChild(option);
            });
          }
        })
        .catch(error => {
          console.error('Fetch error:', error);
        });



      /*=====     End of Countries Select    ======*/





      /*=============================================
      =               Phone Input Mask              =
      =============================================*/

      const phoneInputs = document.querySelectorAll('[type=tel]');

      phoneInputs.forEach(input => {
        input.addEventListener('input', () => {
          input.value = input.value.replace(/[^\d+\-() ]/g, '');
        });

        input.addEventListener('paste', (e) => {
          e.preventDefault();
          const pasted = (e.clipboardData || window.clipboardData).getData('text');
          const cleaned = pasted.replace(/[^\d+\-() ]/g, '');
          document.execCommand('insertText', false, cleaned);
        });
      });


      /*=====     End of Phone Input Mask    ======*/




      /*=============================================
      =                  Copy Link                  =
      =============================================*/

      document.querySelectorAll('[data-copy-url]').forEach(item => {
        item.addEventListener('click', () => {
          const address = window.location.href;
          const successBlock = item.querySelector('[data-success]');
          let delay = 1000;

          if (successBlock) {
            if (successBlock.classList.contains('is-active')) {
              delay += 200; // 200 transition duration
              successBlock.classList.remove('is-active');
              setTimeout(() => {
                successBlock.classList.add('is-active');
              }, 200);
            } else {
              successBlock.classList.add('is-active');
            }

            setTimeout(() => {
              successBlock.classList.remove('is-active');
            }, delay);
          }

          navigator.clipboard.writeText(address).catch(err => {
            console.error('Error copying address:', err);
          });
        });
      });


      /*=====        End of Copy Link        ======*/





      /*=============================================
      =               Apply URL Params              =
      =============================================*/

      function applyUrlParams() {
        const url = new URL(window.location);
        const params = Array.from(new URLSearchParams(url.search).entries());

        params.forEach(([key, value]) => {
          if (key === 'options') {
            value.split('-').forEach(opt => {
              const btn = document.querySelector(`[data-option-btn][data-code="${opt}"]`);
              if (btn) {
                btn.click();
              }
            });
          } else {
            const btn = document.querySelector(`[data-field-name="${key}"][data-value="${value}"]`);
            if (btn) {
              btn.click();
            }
          }
        });
      }

      /*=====     End of Apply URL Params    ======*/




      /*=============================================
      =                Form Submit                  =
      =============================================*/

      document.getElementById('form-open-modal-btn').addEventListener('click', () => {
        const linkInput = document.querySelector('input[name="link"]');
        const screenInput = document.querySelector('input[name="screen"]');
        if (linkInput) {
          linkInput.value = window.location.href;
        }
        if (screenInput) {
          screenInput.value = 'placeholder';
        }
      });

      const form = document.getElementById('summary-form');
      const submitBtn = form.querySelector('#summary-form-submit');
      const error = form.querySelector('#summary-form-error');
      const popupClose = document.querySelector('[data-popup-close="form"]');
      const successTrigger = document.querySelector('[data-popup-open="form-success"]');

      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        if (!form.reportValidity()) return;

        const originalText = submitBtn.textContent;
        submitBtn.textContent = 'Sending...';
        submitBtn.disabled = true;

        const formData = new FormData(form);
        const plainData = Object.fromEntries(formData.entries());

        try {
          const response = await fetch(`${apiUrl}/cms/boats/send-info`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(plainData)
          });

          const result = await response.json();

          if (response.ok) {
            popupClose.click();
            setTimeout(() => {
              successTrigger.click()
              form.reset();
            }, popupDuration * 500);
          } else {
            console.error('Server error:', result);
            error.classList.add('is-shown');
            setTimeout(() => { error.classList.remove('is-shown') }, 5000);
          }
        } catch (error) {
          console.error('Network error:', error);
        } finally {
          setTimeout(() => {
            submitBtn.textContent = originalText;
            submitBtn.disabled = false;
          }, popupDuration * 1000);
        }
      });

      /*=====      End of Form Submit        ======*/

    });

  </script>
</body>

</html>